<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Personal Finance Tracker</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Chart.js -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/chart.js@3.7.0/dist/chart.min.css">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="styles.css">
</head>
<body class="bg-light">
    <div class="container py-4" id="content-to-export">
        <header class="pb-3 mb-4 border-bottom">
            <div class="d-flex justify-content-between align-items-center">
                <h1 class="h2">Personal Finance Tracker</h1>
                <div>
                    <select id="monthSelector" class="form-select mb-2">
                        <option value="">Ch·ªçn th√°ng...</option>
                    </select>
                    <button onclick="exportPDF()" class="btn btn-primary">Xu·∫•t PDF</button>
                </div>
            </div>
        </header>

        <!-- Error Message Container -->
        <div id="error-message"></div>

        <!-- Summary Cards -->
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">T·ªïng Ng√¢n S√°ch</h5>
                        <p class="card-text" id="tongNganSach">0ƒë</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">T·ªïng Chi Ti√™u</h5>
                        <p class="card-text" id="tongChiTieu">0ƒë</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">C√≤n L·∫°i</h5>
                        <p class="card-text" id="conLai">0ƒë</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">Ti·∫øt Ki·ªám</h5>
                        <p class="card-text" id="tietKiem">0ƒë</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Charts -->
        <div class="row mb-4">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">Chi Ti√™u Theo Danh M·ª•c</h5>
                        <canvas id="expenseChart"></canvas>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">Ti·∫øt Ki·ªám Theo Th√°ng</h5>
                        <canvas id="savingChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tables -->
        <div class="row">
            <div class="col-md-6 mb-4">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">K·∫ø Ho·∫°ch Chi Ti√™u</h5>
                        <div class="table-responsive">
                            <table class="table" id="keHoachTable">
                                <thead>
                                    <tr>
                                        <th>Ng√†y</th>
                                        <th>M·ª•c Ti√™u</th>
                                        <th>S·ªë Ti·ªÅn</th>
                                        <th>Ghi Ch√∫</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-6 mb-4">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">Chi Ti√™u C·ª• Th·ªÉ</h5>
                        <div class="table-responsive">
                            <table class="table" id="chiTieuTable">
                                <thead>
                                    <tr>
                                        <th>Ng√†y</th>
                                        <th>M√¥ T·∫£</th>
                                        <th>S·ªë Ti·ªÅn</th>
                                        <th>Danh M·ª•c</th>
                                        <th>Ghi Ch√∫</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://apis.google.com/js/api.js"></script>
    <script src="sheets-api.js"></script>
    <script src="app.js"></script>

    <!-- Export PDF Function -->
    <script>
        function exportPDF() {
            const element = document.getElementById('content-to-export');
            const opt = {
                margin: 1,
                filename: 'finance-report.pdf',
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2 },
                jsPDF: { unit: 'in', format: 'letter', orientation: 'portrait' }
            };

            // Th√¥ng b√°o b·∫Øt ƒë·∫ßu xu·∫•t PDF
            console.log('üñ®Ô∏è B·∫Øt ƒë·∫ßu xu·∫•t PDF...');

            html2pdf().set(opt).from(element).save().then(() => {
                console.log('‚úÖ Xu·∫•t PDF th√†nh c√¥ng!');
            }).catch(error => {
                console.error('‚ùå L·ªói khi xu·∫•t PDF:', error);
                alert('C√≥ l·ªói x·∫£y ra khi xu·∫•t PDF. Vui l√≤ng th·ª≠ l·∫°i sau.');
            });
        }
    </script>
</body>
</html>
